#!/bin/bash
# CDK wrapper script for AWS SSO authentication
# Usage: ./scripts/cdk-sso [any cdk command]
# Example: ./scripts/cdk-sso deploy --require-approval never

set -e

# è‰²ä»˜ãã®å‡ºåŠ›
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆç’°å¢ƒå¤‰æ•° AWS_PROFILE ã¾ãŸã¯ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ "default"ï¼‰
PROFILE=${AWS_PROFILE:-default}

echo -e "${YELLOW}ğŸ” Exporting AWS SSO credentials for profile: $PROFILE${NC}"

# AWS SSOã®èªè¨¼æƒ…å ±ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
EXPORT_OUTPUT=$(aws configure export-credentials --profile $PROFILE --format env 2>&1)
if [ $? -ne 0 ]; then
    echo -e "${RED}âŒ Failed to export AWS credentials.${NC}"
    echo -e "${RED}   Error: $EXPORT_OUTPUT${NC}"
    echo -e "${YELLOW}   Please run: aws sso login --profile $PROFILE${NC}"
    exit 1
fi

eval "$EXPORT_OUTPUT"

echo -e "${GREEN}âœ… AWS credentials exported successfully${NC}"
echo -e "${YELLOW}ğŸš€ Running: npx cdk $@${NC}"

# CDKã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
npx cdk "$@"